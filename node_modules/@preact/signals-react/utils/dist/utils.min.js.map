{"version":3,"file":"utils.min.js","sources":["../src/index.tsx"],"sourcesContent":["import { ReadonlySignal, Signal } from \"@preact/signals-core\";\nimport { useSignal } from \"@preact/signals-react\";\nimport { useSignals } from \"@preact/signals-react/runtime\";\nimport { Fragment, createElement, useMemo, ReactNode } from \"react\";\n\ninterface ShowProps<T = boolean> {\n\twhen: Signal<T> | ReadonlySignal<T> | (() => T);\n\tfallback?: ReactNode;\n\tchildren: ReactNode | ((value: NonNullable<T>) => ReactNode);\n}\n\nconst Item = (props: any) => {\n\tuseSignals();\n\treturn typeof props.children === \"function\"\n\t\t? props.children(props.v, props.i)\n\t\t: props.children;\n};\n\nexport function Show<T = boolean>(props: ShowProps<T>): JSX.Element | null {\n\tuseSignals();\n\tconst value =\n\t\ttypeof props.when === \"function\" ? props.when() : props.when.value;\n\tif (!value) return (props.fallback as JSX.Element) || null;\n\treturn <Item v={value} children={props.children} />;\n}\n\ninterface ForProps<T> {\n\teach:\n\t\t| Signal<Array<T>>\n\t\t| ReadonlySignal<Array<T>>\n\t\t| (() => Signal<Array<T>> | ReadonlySignal<Array<T>>);\n\tfallback?: ReactNode;\n\tchildren: (value: T, index: number) => ReactNode;\n}\n\nexport function For<T>(props: ForProps<T>): JSX.Element | null {\n\tuseSignals();\n\tconst cache = useMemo(() => new Map(), []);\n\tlet list = (\n\t\t(typeof props.each === \"function\" ? props.each() : props.each) as Signal<\n\t\t\tArray<T>\n\t\t>\n\t).value;\n\n\tif (!list.length) return (props.fallback as JSX.Element) || null;\n\n\tconst removed = new Set(cache.keys());\n\n\tconst items = list.map((value, key) => {\n\t\tremoved.delete(value);\n\t\tif (!cache.has(value)) {\n\t\t\tconst result = (\n\t\t\t\t<Item v={value} key={key} i={key} children={props.children} />\n\t\t\t);\n\t\t\tcache.set(value, result);\n\t\t\treturn result;\n\t\t}\n\t\treturn cache.get(value);\n\t});\n\n\tremoved.forEach(value => {\n\t\tcache.delete(value);\n\t});\n\n\treturn createElement(Fragment, { children: items });\n}\n\nexport function useLiveSignal<T>(value: T): Signal<T> {\n\tconst s = useSignal(value);\n\tif (s.peek() !== value) s.value = value;\n\treturn s;\n}\n\nexport function useSignalRef<T>(value: T) {\n\tconst ref = useSignal(value) as Signal<T> & { current: T };\n\tif (!(\"current\" in ref))\n\t\tObject.defineProperty(ref, \"current\", refSignalProto);\n\treturn ref;\n}\nconst refSignalProto = {\n\tconfigurable: true,\n\tget(this: Signal) {\n\t\treturn this.value;\n\t},\n\tset(this: Signal, v: any) {\n\t\tthis.value = v;\n\t},\n};\n"],"names":["g","f","exports","module","require","define","amd","globalThis","self","reactSignalsutils","signalsReact","reactSignalsRuntime","react","this","runtime","Item","props","useSignals","children","v","i","refSignalProto","configurable","get","value","set","For","cache","useMemo","Map","list","each","length","fallback","removed","Set","keys","items","map","key","has","result","createElement","forEach","Fragment","Show","when","useLiveSignal","s","useSignal","peek","useSignalRef","ref","Object","defineProperty"],"mappings":"CAWA,SAAAA,EAAAC,GAAA,iBAAAC,SAAA,oBAAAC,OAAAF,EAAAC,QAAAE,QAAA,yBAAAA,QAAA,iCAAAA,QAAA,UAAA,mBAAAC,QAAAA,OAAAC,IAAAD,OAAA,CAAA,UAAA,wBAAA,gCAAA,SAAAJ,GAAAA,GAAAD,EAAA,oBAAAO,WAAAA,WAAAP,GAAAQ,MAAAC,kBAAA,CAAA,EAAAT,EAAAU,aAAAV,EAAAW,oBAAAX,EAAAY,MAAA,CAAA,CAAAC,KAAA,SAAAX,EAAAQ,EAAAI,EAAAF,GAAA,IAAMG,EAAO,SAACC,GACbC,EAAAA,aACA,MAAiC,mBAAnBD,EAAME,SACjBF,EAAME,SAASF,EAAMG,EAAGH,EAAMI,GAC9BJ,EAAME,QACV,EA+DMG,EAAiB,CACtBC,cAAc,EACdC,eACC,YAAYC,KACb,EACAC,IAAG,SAAeN,GACjBN,KAAKW,MAAQL,CACd,GACAjB,EAAAwB,IApDK,SAAiBV,GACtBC,eACA,IAAMU,EAAQC,UAAQ,WAAA,WAAUC,GAAK,EAAE,IACnCC,GACoB,mBAAfd,EAAMe,KAAsBf,EAAMe,OAASf,EAAMe,MAGxDP,MAEF,IAAKM,EAAKE,OAAQ,OAAQhB,EAAMiB,UAA4B,KAE5D,IAAMC,EAAU,IAAIC,IAAIR,EAAMS,QAExBC,EAAQP,EAAKQ,IAAI,SAACd,EAAOe,GAC9BL,EAAc,OAACV,GACf,IAAKG,EAAMa,IAAIhB,GAAQ,CACtB,IAAMiB,EACLC,EAACA,cAAA3B,GAAKI,EAAGK,EAAOe,IAAKA,EAAKnB,EAAGmB,EAAKrB,SAAUF,EAAME,WAEnDS,EAAMF,IAAID,EAAOiB,GACjB,OAAOA,CACR,CACA,OAAOd,EAAMJ,IAAIC,EAClB,GAEAU,EAAQS,QAAQ,SAAAnB,GACfG,EAAY,OAACH,EACd,GAEA,OAAOkB,EAAaA,cAACE,WAAU,CAAE1B,SAAUmB,GAC5C,EAsBCnC,EAAA2C,KArEe,SAAkB7B,GACjCC,EAAUA,aACV,IAAMO,EACiB,mBAAfR,EAAM8B,KAAsB9B,EAAM8B,OAAS9B,EAAM8B,KAAKtB,MAC9D,IAAKA,EAAO,OAAQR,EAAMiB,UAA4B,UACtD,OAAOS,EAACA,cAAA3B,EAAK,CAAAI,EAAGK,EAAON,SAAUF,EAAME,UACxC,EA+DChB,EAAA6C,cApBe,SAAiBvB,GAChC,IAAMwB,EAAIC,YAAUzB,GACpB,GAAIwB,EAAEE,SAAW1B,EAAOwB,EAAExB,MAAQA,EAClC,OAAOwB,CACR,EAgBC9C,EAAAiD,aAdK,SAA0B3B,GAC/B,IAAM4B,EAAMH,EAASA,UAACzB,GACtB,KAAM,YAAa4B,GAClBC,OAAOC,eAAeF,EAAK,UAAW/B,GACvC,OAAO+B,CACR,CASC"}